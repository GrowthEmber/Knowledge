# 画像自動貼り付け

## エビデンス整理

```
Sub PasteImagesWithRowGap()

    Dim ws As Worksheet
    Dim folderPath As String
    Dim fileName As String
    Dim startCell As Range
    Dim gapRows As Long
    Dim currentRow As Long
    Dim shp As Shape

    Set ws = ActiveSheet

    ' === フォルダ選択 ===
    With Application.FileDialog(msoFileDialogFolderPicker)
        .Title = "画像フォルダを選択してください"
        If .Show <> -1 Then Exit Sub
        folderPath = .SelectedItems(1)
    End With

    ' === 開始セル指定 ===
    On Error Resume Next
    Set startCell = Application.InputBox( _
        "貼り付け開始セルを指定してください（例：C5）", Type:=8)
    On Error GoTo 0
    If startCell Is Nothing Then Exit Sub

    ' === 行間隔指定 ===
    gapRows = Application.InputBox( _
        "画像の下に空ける行数を入力してください", _
        Default:=3, Type:=1)
    If gapRows < 0 Then Exit Sub

    ' 初期行
    currentRow = startCell.Row

    ' === 画像取得（jpg / png） ===
    fileName = Dir(folderPath & "\*.jpg")
    If fileName = "" Then fileName = Dir(folderPath & "\*.png")

    Do While fileName <> ""

        ' 画像貼り付け
        ws.Shapes.AddPicture _
            fileName:=folderPath & "\" & fileName, _
            LinkToFile:=msoFalse, _
            SaveWithDocument:=msoTrue, _
            Left:=startCell.Left, _
            Top:=ws.Cells(currentRow, startCell.Column).Top, _
            Width:=-1, _
            Height:=-1

        Set shp = ws.Shapes(ws.Shapes.Count)

        ' サイズ調整（必要に応じて）
        shp.LockAspectRatio = msoTrue

        ' === 画像の一番下にかかっている行番号を取得 ===
        currentRow = shp.BottomRightCell.Row + gapRows

        fileName = Dir()
    Loop

End Sub

```

---
