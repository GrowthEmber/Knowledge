# ファイル操作

## touch：ファイル作成・更新
- コマンド：`touch`
  - 空ファイル作成<br>　`touch app.txt`
    - アクセス時刻、更新時刻が更新される
  - 指定日時に変更<br>　`touch -t 202501010000 app.txt`
  - 人間向け<br>　`touch -d "2025-01-01 00:00" test.txt`<br>`touch -d "yesterday" test.txt`
  - 参照コピー<br>　`touch -r base.txt target.txt`
    - `target.txt` の時刻を `base.txt` と同じに

| オプション | 説明 |
|---|---|
| -t | タイムスタンプを変更<br>形式；YYYYMMDDhhmm |
| -a | 最終アクセス日時のみ変更 |
| -m | 最終更新日時のみ変更 |
| -c | ファイルが存在しない場合は作成しない |
| -r 参照ファイル | 参照ファイルと同じ時刻にする |

## cd：移動
- コマンド：`cd`
  - 別ディレクトリへ移動<br>　`cd dir1/dir2/dir3`

## ls：一覧表示
- コマンド: `ls`
  - 隠しファイル含む・時刻順・詳細表示<br>　`ls -alt`

| オプション | 説明 |
|---|---|
| -a | 隠しファイル含む |
| -A | `.` `..` を除き隠し含む |
| -l | 詳細表示 |
| -h | 人間可読サイズ |
| -R | 再帰 |
| -t | 時刻順 |
| -S | サイズ順 |
| -r | 逆順 |
| -d | ディレクトリ自身を表示 |
| -F | 種別記号付与 |
| -i | inode 表示 |
| -n | UID/GID 数値表示 |
| -1 | 1 行 1 ファイル |
| --color=auto | 色付け |

## cat・less：ファイル内容表示
- コマンド：`cat`
- コマンド：`less`
  - 行番号・折り返しなし・詳細ステータス・カラー保持でログ監視<br>　`less -NSMR +F test.log`

**lessショートカットキー**
| 移動系キー | 内容 |
| --- | --- |
| f / Space | 次のページ |
| b | 前のページ |
| j / ↓ | 1行下 |
| k + ↑ | 1行上 |
| g | 先頭へ |
| G | 最終行へ |
| 100g | 100行目へ |
| d | 半ページ下 |
| u | 半ページ上 |

| 検索系キー | 内容 |
| --- | --- |
| /文字列 | 前方検索<br>・対象が白色でハイライト<br>・カーソル移動可能 |
| ?文字列 | 後方検索<br>・対象が白色でハイライト<br>・カーソル移動可能 |
| n | 次の一致 |
| N | 前の一致 |
| &文字列 | 一致行のみ表示<br>・規表現使用可能<br>・カーソル移動不可<br>・lessから出たくない時に便利 |

| 表示制御系キー | 内容 |
| --- | --- |
| -N | 行表示 ON/OFF |
| -S | 折り返し ON/OFF |
| -M | 詳細ステータス表示 ON/OFF |
| -m | 進捗率のみ表示 ON/OFF |
| -R | ANSIカラーをそのまま表示 |
| F / +F | tail -f 相当（起動時指定、操作時はF） |
| = | ファイル詳細表示 |
| Ctrl + g | 現在位置表示 |

| ファイル操作系キー | 内容 |
| --- | --- |
| :n | 次のファイル |
| :p | 前のフィル |
| :x | 現在ファイル削除（※注意） |
| r | 再読み込み |

| ファイル操作系キー | 内容 |
| --- | --- |
| q | 終了 |
| h | ヘルプ |
| v | `$EDITOR` で開く |

## grep：検索
- コマンド: `grep`
  - エラー監視<br>　`grep -n --color=always ERROR app.log | less -NSMR +F`
    - `-n`：行番号付与
    - `-R`：grepの色を保持
    - `+F`：追記監視（Ctrl + C で解除）
  - 拡張正規表現<br>　`grep --color=always -E 'ERROR|WARN|FATAL' app.log | less -NSMR`
    - `-E`：拡張正規表現
  - 除外条件付き表示<br>　`grep --color=always ERROR app.log | grep -v HealthCheck | less -NSMR`
    - `-v`：一致しない行を除外
  - リアルタイム監視（ログローテーション対応）<br>　`tail -F app.log | grep --color=always --line-buffered ERROR | less -NSMR`
    - `tail -F`
      - ファイル名追従
      - ローテーション対応
    - `--line-buffered`
      - 1行ごとに即表示（必須）

### 最強のエラーログ監視コマンド
`tail -F xxx.log | grep --color=always --line-buffered -nE "ERROR|WARN" | less -NSMR +F`

- ノイズ除去
  - `tail -F xxx.log | grep --color=always --line-buffered -nE "ERROR|WARN" | grep -Ev 'CreateTransaction|INFO.*commit' | less -NSMR +F`

| オプション | 説明 |
|---|---|
| -r | 再帰 |
| -i | 大小無視 |
| -n | 行番号 |
| -v | 除外 |
| -E | 拡張正規表現 |
| -F | 固定文字列 |

---
